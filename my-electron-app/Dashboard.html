<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<html class="back">
    <link id="pagestyle" href="./dashboard.css" rel="stylesheet" type="text/css" />

    <head>
        <div class="sidebar">
            <div id="heyobg" class="heyobg">
                <h2 id="heyo">HEYO</h2>
            </div>
            <div class="choices">
                <label id="dash">DASHBOARD</label>
                <label id="cal">CALENDAR</label>
                <label id="Entry">ENTRY</label>
                <label id="todo">TO DO</label>
                <button id="theme">Change theme</button>
            </div>
        </div>
    </head>
    <body>
        <div id="img">
            <canvas id="mychart" width="850px" height="315px"></canvas>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <script>
                var pg = require('pg');
                let usernameg = localStorage.getItem("userg");
    let conp = localStorage.getItem("passg");
            let today = new Date().toISOString();
          var moodchart = [];
          var datechart = [];

          var gconn = new pg.Client("postgres://"+usernameg+":"+conp+"@74.68.42.21:5432/heyo_scale");
          gconn.connect(function (err){
            
          
            var rang= new Date();
            var isodate = rang.setDate(rang.getDate() - 7);
            isodate = new Date(isodate).toISOString()
            sql = "SELECT moodrating FROM public."+usernameg+" WHERE date between '"+isodate+"' and '"+today+"'";
            sql2 = "SELECT date FROM public."+usernameg+" WHERE date between '"+isodate+"' and '"+today+"'";

                gconn.query(sql, function (err, result) {
                  var moodnum = [];
                  for(var i =0;i < 8;i++)
                  {
                    moodchart[i] = Object.values(result.rows[i]);
                  }
                  console.log(moodchart)


                  gconn.query(sql2,function(err,result){
                    for(var i =0;i < 8; i++)
                    {
                      datechart[i] = Object.values(result.rows[i])
                      console.log(datechart[i])
                      console.log(datechart)
                    }
                  })

                  var ctx = document.getElementById('mychart');
                  var mychart = new Chart(ctx, {
                  // The type of chart we want to create
                  type: 'line',
                  // The data for our dataset
                  data: {
                    
                  //labels:[1,2,3,4,5,6,7],
                  datasets: [{
                      label: 'ur mom',
                      backgroundColor: 'rgb(255, 99, 132)',
                      borderColor: 'rgb(255, 99, 132)',
                      data:[{
                    x:"'"+datechart[0]+"'",
                    y:moodchart[0]
                  },{
                    x:datechart[1],
                    y:moodchart[1]
                  },{
                    x:datechart[2],
                    y:moodchart[2]
                  },{
                    x:datechart[3],
                    y:moodchart[3]
                  },{
                    x:datechart[4],
                    y:moodchart[4]
                  },{
                    x:datechart[5],
                    y:moodchart[5]
                  },{
                    x:datechart[6],
                    y:moodchart[6]
                  },{
                    x:datechart[7],
                    y:moodchart[7]
                  }]
                    }]
                  },
                  //config
                  option:{
                    scales:{
                      x:{
                        type:'time',
                        time:{
                          unit:'day',
                          displayFormats: {
                            day: 'D MMM yyyy'
                          }
                        }
                      }
                    }
                  }
                      
                    
                  
                }); 
              });
                          
              });
        
          </script>
        <button id="moods">Record mood</button>
        <div id="wtodo">To Do</div>
    </body>
    
    <script src="dashboard.js"></script>
</html>
